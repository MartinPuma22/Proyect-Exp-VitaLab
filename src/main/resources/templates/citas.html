<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Citas | VitaLab</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>

<div class="container mt-4">
    <h2 class="text-center">Gestión de Citas</h2>

    <!-- Formulario de registro/edición -->
    <div class="card mb-4">
        <div th:classappend="${modoEdicion} ? 'border-warning' : 'border-primary'">
            <div th:classappend="${modoEdicion} ? 'bg-warning text-dark' : 'bg-primary text-white'"
                 class="card-header">
                <span th:text="${modoEdicion} ? 'Editar Cita' : 'Registrar Nueva Cita'"></span>
            </div>
            <div class="card-body">
                <form th:action="@{/citas/guardar}" th:object="${cita}" method="post">
                    <input type="hidden" th:field="*{id}"/>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Paciente</label>
                            <select class="form-select" name="pacienteId" required>
                                <option value="">Seleccione un paciente</option>
                                <option th:each="p : ${pacientes}"
                                        th:value="${p.id}"
                                        th:selected="${cita.paciente != null and p.id == cita.paciente.id}"
                                        th:text="${p.nombre + ' ' + p.apellido + ' (' + p.dni + ')'}">
                                </option>
                            </select>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Doctor</label>
                            <select class="form-select" name="doctorId" required>
                                <option value="">Seleccione un doctor</option>
                                <option th:each="d : ${doctores}"
                                        th:value="${d.id}"
                                        th:selected="${cita.doctor != null and d.id == cita.doctor.id}"
                                        th:text="${d.nombre}">
                                </option>
                            </select>

                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Fecha</label>
                            <input type="date" class="form-control" th:field="*{fecha}" required>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Hora</label>
                            <input type="time" class="form-control" th:field="*{hora}" required>
                        </div>
                        <div class="col-md-8">
                            <label class="form-label">Diagnóstico</label>
                            <input type="text" class="form-control" th:field="*{diagnostico}" placeholder="Diagnóstico breve" required>
                        </div>
                    </div>

                    <div class="text-end">
                        <button type="submit" th:text="${modoEdicion} ? 'Actualizar Cita' : 'Guardar Cita'"
                                th:classappend="${modoEdicion} ? 'btn-warning' : 'btn-success'"
                                class="btn">
                        </button>
                        <a th:if="${modoEdicion}" href="/citas" class="btn btn-secondary ms-2">Cancelar</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Tabla de citas -->
    <table class="table table-bordered table-striped">
        <thead class="table-primary">
        <tr>
            <th>ID</th>
            <th>Paciente (DNI)</th>
            <th>Doctor</th>
            <th>Diagnóstico</th>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Acciones</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="cita : ${listaCitas}">
            <td th:text="${cita.id}"></td>
            <td th:text="${cita.paciente.nombre + ' (' + cita.paciente.dni + ')'}"></td>
            <td th:text="${cita.doctor.nombre}"></td>
            <td th:text="${cita.diagnostico}"></td>
            <td th:text="${#temporals.format(cita.fecha, 'dd/MM/yyyy')}"></td>
            <td th:text="${#temporals.format(cita.hora, 'HH:mm')}"></td>
            <td>
                <a class="btn btn-warning btn-sm" th:href="@{/citas/editar/{id}(id=${cita.id})}">Editar</a>
                <a class="btn btn-danger btn-sm" th:href="@{/citas/eliminar/{id}(id=${cita.id})}">Eliminar</a>
            </td>
        </tr>
        </tbody>
    </table>

    <a class="btn btn-secondary mt-3" th:href="@{/}">Volver</a>
</div>

</body>
</html>





